<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta th:include="common/head :: common_css(title='DataRoom')"></meta>
    <style>
	th {
	    text-align: center;
	    vertical-align: middle !important;
	    
	}
	td {
	    text-align: center;
	   	vertical-align: middle !important;
	    
	}
	</style>
</head>

<body class="horizontal-nav boxed skin-megna fixed-layout">
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->
    <div class="preloader">
        <div class="loader">
            <div class="loader__figure"></div>
            <p class="loader__label">UJBLib admin</p>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- Main wrapper - style you can find in pages.scss -->
    <!-- ============================================================== -->
    <div id="main-wrapper">

        <!-- Top Header -->
        <header th:replace="common/menu-header :: common"></header>
        
        <!-- Left Menu-->
        <aside th:replace="common/menu-aside :: common (menuCd1=dashboard, menuCd2=dashboard)"></aside>

        <!-- Page Content : Start { -->
        <div id="page-wrapper">
            <div class="container-fluid">
                <div class="row page-titles">
                    <div class="col-md-5 align-self-center">
                        <h4 class="text-themecolor">자원봉사</h4>
                    </div>
                    <div class="col-md-7 align-self-center text-right">
                        <div class="d-flex justify-content-end align-items-center">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="javascript:void(0)">Home</a></li>
                                <li class="breadcrumb-item">자료실</li>
                                <li class="breadcrumb-item active">자원봉사</li>
                            </ol>
                        </div>
                    </div>
                </div>
               	<form >
               	<input type="hidden" id="id" th:value="${volunteerLog.id}" />
               	<input type="hidden" id="pYear" th:value="${volunteerLog.pYear}" />
               	
               	<div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="input-group">
                                <input type="text" id="pDate" placeholder="yyyy-mm-dd" th:value="${volunteerLog.pDate}">
                                <div class="input-group-append">
                                    <span class="input-group-text"><i class="icon-calender"></i></span>
                                </div>
                            <div class="form-actions">
				            		<th:block th:each="result : ${session.menus}" th:object="${result}" th:if="${result.menuId == 4 and result.updateYn}">
				                	<button type="button" class="btn btn-success btnVolunteerLogSave"> <i class="fa fa-check"></i> 저장</button>
				                	<button type="button" class="btn btn-danger btnVolunteerLogDelete"> <i class="fa fa-check"></i> 삭제</button>
				                </th:block>
				                <button type="button" class="btn btn-inverse btn-infobtnCancel" onClick="history.go(-1); return false;"> 목록</button>
				                
				                <th:block th:each="result : ${session.menus}" th:object="${result}" th:if="${result.menuId == 4 and result.printYn}">
				                <!-- <button type="button" class="btn btn-inverse">출력</button>  -->	
				                </th:block>
				            		</div>
				            		<div class="col-md-7 align-self-center text-right">	
                        				<div class="d-flex justify-content-end align-items-center">
										<span  th:text="${'도서관 개관일 : ' + openDays}" >222</span>
                        				</div>
                        			</div>
                        </div>
                    </div>
                </div>
                </div>
               	<div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">
                                <h4 class="card-title">1. 자원봉사</h>
                                <h6 class="card-subtitle"></h6>
                                <div class="table-responsive">
                                    <table id="UserStaticTB" class="table editable-table table-bordered m-b-0">
                                        <thead>
                                            <tr class="table-active">
												<th rowspan="2" >구분</th>
												<th colspan="2">청소년</th>
												<th colspan="2">일반</th>
											</tr>
											<tr class="table-active">
												<th>남</th>
												<th>여</th>
												<th>남</th>
												<th>여</th>
											</tr>
										</thead>
                                        <tbody>
											<tr>
												<th>일계</th>
												<td class="UserYouthBoyVolunteer">[[${volunteerLog.UserYouthBoyVolunteer}]]</td>
	                                            <td class="UserYouthGirlVolunteer">[[${volunteerLog.UserYouthGirlVolunteer}]]</td>
												<td class="UserManVolunteer">[[${volunteerLog.UserManVolunteer}]]</td>
	                                            <td class="UserWomanVolunteer">[[${volunteerLog.UserWomanVolunteer}]]</td>
											</tr>
											
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
	                <div class="col-12">
	                        <div class="card">
	                            <div class="card-body">
	                                <h4 class="card-title">2. 기타사항</h>
	                                <h6 class="card-subtitle"></h6>
	                                <div class="table-responsive">
	                                    <table id="RobotStaticTB" class="table editable-table table-bordered  m-b-0" align="center" >
	                                    	<tbody>
												<td><textarea class="form-control" id="EtcInform" name="EtcInform" row="5" >[[${volunteerLog.etcInform}]]</textarea></td>
	                                        </tbody>
	                                    </table>
	                                </div>
	                            </div>
	                        </div>
	            		</div>
	            </div>
                </form>
                <!--/form body-->
                <div class="col-12">
					<div class="card">
 						<div class="card-body">
 							<div class="form-actions">
				            	<th:block th:each="result : ${session.menus}" th:object="${result}" th:if="${result.menuId == 4 and result.updateYn}">
				                	<button type="button" class="btn btn-success btnVolunteerLogSave" > <i class="fa fa-check"></i> 저장</button>
				                	<button type="button" class="btn btn-danger btnVolunteerLogDelete"> <i class="fa fa-check"></i> 삭제</button>
				                </th:block>
				                <button type="button" class="btn btn-inverse btn-infobtnCancel" onClick="history.go(-1); return false;"> 목록</button>
				                
				                <th:block th:each="result : ${session.menus}" th:object="${result}" th:if="${result.menuId == 4 and result.printYn}">
				                	<!-- <button type="button" class="btn btn-inverse">출력</button>  -->
				                </th:block>
				            </div>
						</div>
					</div>
                </div>
                 
            </div>
        </div>
    </div>
        <!-- } Page Content : End -->
        <!-- footer -->
        <footer th:replace="common/footer :: footer" ></footer>
        
    <!-- } Wrapper : End -->
    
    <section th:replace="common/js :: js"></section>
    <section th:replace="common/modal-popup :: modal('TK')"></section>
    <!-- Date picker plugins css -->
    <link href="/elite/assets/node_modules/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css" />
    <script src="/elite/assets/node_modules/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    
    
    <!-- Editable -->
    <script src="/elite/assets/node_modules/jquery-datatables-editable/jquery.dataTables.js"></script>
    <script src="/elite/assets/node_modules/datatables/dataTables.bootstrap.js"></script>
    <script src="/elite/assets/node_modules/tiny-editable/mindmup-editabletable.js"></script>
    <script src="/elite/assets/node_modules/tiny-editable/numeric-input-example.js"></script>
    <script>
    
    $('#UserStaticTB').editableTableWidget().numericInputExample().find('td:first').focus();
    
    $(document).ready(function() {
        pDateChange();
        var cDate  = new Date();
		var pDate = new Date( $("#pDate").val() );
		if(pDate.withoutTime() >= cDate.withoutTime()){
			alert("근무일지는 현재일 이전에만 작성 할 수 있습니다.");
			history.back(-1);
		}
		
    });
    
    $('#pDate').datepicker({
        autoclose: true,
        todayHighlight: true,
        format:'yyyy-mm-dd',
        language:'kr'
    });
    $(".btnCancel").click(function () {
		location.href = "/dataroom/volunteerLog";
	});
    
   $(".btnVolunteerLogDelete").click(function () {
    	
	   if($("#id").val() == "") {
		   alert("대상이 존재 하지 않습니다.");
		   return;
	   }
    	if(confirm("근무 일지를 삭제하시겠습니까?")){
    		var eventData = {id:$("#id").val()}
    		$.ajax({
    			url : "/dataroom/volunteerLog/delete/",
    			method : "put",
    			data:eventData,
    			success : function(result) {
    				alert("삭제되었습니다.");
    				location.href="/dataroom/volunteerLog";
    			},
    			error : function(data) {
    				console.error("Update snapshot", data);
    			}
    	    });
    	}else{

    	}
	});
    
        $(".btnVolunteerLogSave").click(function () {
        	var arrData=[];
        	var eventData = {id:$("#id").val(), pYear:$("#pYear").val(),  pDate:$("#pDate").val() }; 
      		   
    			   
				$("#UserStaticTB tr").each(function(index){
   			   		var currentRow = $(this).closest("tr");
	    			if(index==1){
	    				eventData.UserYouthBoyVolunteer 	= $(".UserYouthBoyVolunteer").text();
	    				eventData.UserYouthGirlVolunteer 	= $(".UserYouthGirlVolunteer").text();
	    				eventData.UserManVolunteer 			= $(".UserManVolunteer").text();
	    				eventData.UserWomanVolunteer 	= $(".UserWomanVolunteer").text();
	    				
	    			}
				});
				
			eventData.EtcInform= $("#EtcInform").val();
				
       		$.ajax({
				url : "/dataroom/volunteerLog/create",
				data: eventData,
				method : "put",
				success : function(result) {
					alert("등록되었습니다.");
					location.href="/dataroom/volunteerLog";
				},
				error : function(data) {
					console.error("Update snapshot", data);
				}
		    });
        });
    
    var pDateChange = function(){
    	
		var date = $('#pDate').datepicker('getDate');
    	
		if(isEqCurrentDate(date)){
			date.setDate(date.getDate() - 1);
			$('#pDate').datepicker("setDate", date);
		}
		
    	$("#pDate").change(function(){
			location.href="/dataroom/volunteerLog/view/"+$("#pDate").val();
		
    	});
    }
    </script>
</body>

</html>
