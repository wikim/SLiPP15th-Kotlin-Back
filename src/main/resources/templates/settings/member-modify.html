<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
	<meta th:include="common/head :: common_css(title='Members')"></meta>
</head>

<body class="horizontal-nav boxed skin-megna fixed-layout">
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->
    <div class="preloader">
        <div class="loader">
            <div class="loader__figure"></div>
            <p class="loader__label">UJBLib admin</p>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- Main wrapper - style you can find in pages.scss -->
    <!-- ============================================================== -->
    <div id="main-wrapper">

       	<!-- Top Header -->
	    <header th:replace="common/menu-header :: common"></header>
        
        <!-- Left Menu-->
        <aside th:replace="common/menu-aside :: common (menuCd1=dashboard, menuCd2=dashboard)"></aside>

        <!-- Page Content : Start { -->
        <div id="page-wrapper">
            <div class="container-fluid">
            	<div class="row page-titles">
                    <div class="col-md-5 align-self-center">
                        <h4 class="text-themecolor">사용자관리</h4>
                    </div>
                    <div class="col-md-7 align-self-center text-right">
                        <div class="d-flex justify-content-end align-items-center">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="javascript:void(0)">Home</a></li>
                                <li class="breadcrumb-item active">관리자</li>
                                <li class="breadcrumb-item active">사용자관리</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <!-- Row -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <form method="post" id="mainForm" name="mainForm" th:action="@{'/settings/member/modify/' + ${member.id}}"  th:object="${member}">
								<input type="hidden" id="_method" name="_method" value="put" />
								<input type="hidden" id="id" name="id" th:value=" ${member.id}" />
                                
                                    <div class="form-body">
                                        <h3 class="card-title">신규사용자 추가</h3>
                                        <div class="row p-t-0">
                                            <div class="col-md-6">
                                                <div class="form-group has-success" >
                                                    <label class="control-label">로그인ID</label>
                                                    <input type="text" id="signinId"  name="signinId" class="form-control" placeholder="" th:value="${member.signinId}">
                                                    <small class="form-control-feedback"> 3~10자 이하의 한글,영문,숫자로 입력할 수 있습니다.</small> </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group has-success">
                                                   
                                                    </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        
                                        <div class="row p-t-0">
                                            <div class="col-md-6">
                                                <div class="form-group has-success" >
                                                    <label class="control-label">이름</label>
                                                    <input type="text" id="name" name="name" class="form-control" placeholder="" th:value="${member.name}" >
                                                    <small class="form-control-feedback"> 10자이하의 실명을 적어 주세요. </small> </div>
                                            </div>
                                            <!--/span-->
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label">상태</label>
                                                     <select class="form-control" id="status" name="status">
			                                         	<option value="ACTIVE">사용</option>
			                                         	<option value="STOP">중지</option>
			                                         </select>
                                                    <small class="form-control-feedback"></small> </div>
                                            </div>
                                            <!--/span-->
                                        </div>
                                        
                                        <!--/row-->
                                        <div class="row p-t-0">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    <label class="control-label">부서</label>
                                                    <input type="text" id="departmentNm" name="departmentNm" class="form-control" placeholder="" th:value="${member.departmentNm}">
                                                    <small class="form-control-feedback"></small> </div>
                                            </div>
                                             <div class="col-md-6">
	                                                <div class="form-group">
	                                                    <label class="control-label">직책</label>
	                                                    <select class="form-control" name="gradeNm" style="font-size: 12px">
						                                 	<option value="문헌정보과장" th:selected="${member.gradeNm == '문헌정보과장'}">문헌정보과장</option>
						                                 	<option value="학교도서관지원과장" th:selected="${member.gradeNm == '학교도서관지원과장'}" >학교도서관지원과장</option>
						                                 	<option value="주무관" th:selected="${member.gradeNm == '주무관'}" >주무관</option>
						                                 	<option value="공익" th:selected="${member.gradeNm == '공익'}" >공익</option>
						                                 </select>
	                                                    <small class="form-control-feedback"></small> 
	                                                 </div>
                                             </div> 
                                        </div>
                                        
                                        
                                    <!--/form body-->
                                    <div class="form-actions">
                                        <button type="submit" id="btnSave" class="btn btn-success"> <i class="fa fa-check"></i> 저장 </button>
                                        <button type="button" class="btn btn-danger waves-effect waves-light"  id="btnDelete" >삭제 </button>
                                        <button type="button" class="btn btn-inverse" onClick="history.go(-1); return false;">취소 </button>
                                    </div>
                            	</form>
							</div>
						</div>
                	</div>
                </div>
            </div>
        </div>
        <!-- Row -->
        <div id="responsive-modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
	        <div class="modal-dialog">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h4 class="modal-title">패스워드 변경</h4>
	                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
	                </div>
	                <div class="modal-body">
	                    <form>
	                        <div class="form-group">
	                            <label for="message-text" class="control-label"> 변경 할 패스워드 </label>
	                           	<input type="password" class="form-control" id="password_1" name="password_1">
	                        </div>
	                        <div class="form-group">
	                            <label for="message-text" class="control-label"> 패스워드 확인 </label>
	                            <input type="password" class="form-control" id="password_2" name="password_2">
	                        </div>
	                    </form>
	                </div>
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">창닫기</button>
	                    <button type="button" class="btn btn-success waves-effect waves-light"  id="btnSavePasswd">저장</button>
	                </div>
	            </div>
	        </div>
	    </div>
        <!-- } Page Content : End -->
		<!-- footer -->
		<footer th:replace="common/footer :: footer" ></footer>
        
    </div>
    <!-- } Wrapper : End -->
    
    <section th:replace="common/js :: js"></section>
    <section th:replace="common/modal-popup :: modal('TK')"></section>
    <script type="text/javascript">
    $(document).ready(function(){
    	
    	$("#btnSave").on("click", function () {
    		
    		$(this).prop("disabled", true);
    	    $(this).button('complete');
    	    $("#mainForm").submit();
    	
    	});
    	btnSavePasswd();
    	modalActive();
    	btnDelete();
    });
    
    var modalActive = function(){
    	$( "button[name='btnModal']" ).click(function () {
        	$("#id").val(this.value)
    	 });
    }
    
    var btnSavePasswd = function(){
        $("#btnSavePasswd").click(function () {
        	var arrData=[];
        	var eventData = {id:$("#id").val()
        			};
        	
        	$.ajax({
    			url : "/settings/member/password",
    			data: eventData,
    			method : "put",
    			success : function(result) {
    				if(result.no==200){
    					alert("등록되었습니다.");
    					
    				}else if(result.no==201){
    					alert("패스워드가 일치 하지 않습니다..");
    				}
    				
    				$('#responsive-modal').modal('hide');
    				location.reload();

    			},
    			error : function(data) {
    				console.error("Update snapshot", data);
    			}
    	    });
        });
     }
    
    function btnDelete(){
 	   $("#btnDelete").click(function () {
 		   var id =$("#id").val();
 		   console.log("id:"+id);
 		   if(id == "" ){
 			   return;
 		   }
 		   else{
 			   confirm("삭제하시겠습니가?");
 		   }
 			var arrData = {
 	    			id:id
 			}
 		   $.ajax({
 				url : "/settings/member/delete/"+id,
 				data: arrData,
 				method : "put",
 				success : function(result) {
 					alert("삭제되었습니다.");
 					location.href="/settings/members";
 				},
 				error : function(data) {
 					console.error("오류.", data);
 				}
 		    });
 	   })
     }
    </script>
</body>

</html>
